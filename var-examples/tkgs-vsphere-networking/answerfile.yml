# path to vCenter installer ISO
vc_iso: "{{ lookup('env', 'SOFTWARE_DIR') }}/VMware-VCSA-all-7.0.1-17004997.iso"
esxi_ova: "{{ lookup('env', 'SOFTWARE_DIR') }}/Nested_ESXi7.0.1_Appliance_Template_v1.ova"

environment_tag: "tkgs" # Used to prepend object names
dns1: "192.168.0.110"
dns2: "192.168.0.1"
domain: "home.local"
ntp: time1.google.com
disk_mode: thin #How all disks should be deployed
# This will be set everywhere!
master_password: "VMware1!"
nested_host_password: "{{master_password}}"

hosting_vcenter: # This is the vCenter which will be the target for nested vCenters and ESXi hosts
    ip: "192.168.0.113"
    user: "{{ lookup('env', 'PARENT_VCENTER_USERNAME') }}"
    password: "{{ lookup('env', 'PARENT_VCENTER_PASSWORD') }}"
    datacenter: "Home" # Target for all VM deployment

nested_vcenter: # the vCenter appliance that will be deployed
    ip: "192.168.0.171" # vCenter ip address 
    mask: "22"
    gw: "192.168.0.1"
    host_name: "192.168.0.171" # FQDN if there is working DNS server, otherwise put the ip as a name
    user: "administrator@vsphere.local" 
    password: "{{master_password}}"
    datacenter: "Lab" # DC to create after deployment
    # Below are properties of parent cluster
    hosting_network: "Net1" # Parent port group where the vCenter VM will be deployed
    hosting_cluster: "Physical" # Parent cluster where the vCenter VM will be deployed
    hosting_datastore: "NVME" # Parent datastore where the vCenter VM will be deployed
    
nested_clusters: # You can add clusters in this section by duplicating the existing cluster
    tkgs-cluster: # This will be the name of the cluster in the nested  vCenter. Below are the minimum settings.
        drs: True
        # HA can only be enabled if there is are datastores accessible by all hosts.
        ha_enabled: True
        ha_admission_control_enabled: False
        ha_host_monitoring_enabled: disabled
        # Settings below are assigned to each host in the cluster
        vswitch0_vm_port_group_name: net1
        vswitch0_vm_port_group_vlan: 0
        cpu_cores: 6 # CPU count
        ram_in_gb: 96 # memory
        # In order list of disks to assign to the nested host. All will be marked as SSD.
        # Datastore names will be automatically be pre-pended with the hostname. E.g esx1
        # If the datastore_prefix property is removed the disk will not be set as a datastore
        # To leave the default OVA disks in place, delete this section.
        nested_hosts_disks: 
            -   size_gb: 400
                datastore_prefix: "datastore" 
        # Below are properties of the hosting cluster
        hosting_cluster: "Physical" # the cluster where physical ESXi is connected to. The nested VMs will be deployed here
        hosting_datastore: "NVME" # Datastore target for nested ESXi VMs
        # In vmnic order, these port groups must exist on the physical host
        # Must specify at least 2 port groups, up to a maximum of 10
        vmnic_physical_portgroup_assignment: 
            -   name: "Nest"
            -   name: "Nest"

# You can add nested ESXi hosts below
nested_hosts:
    esx1: # environment_tag will prepend the name to create the VM name
        ip: 192.168.0.172 # This will also be used as the hostname in the nested vCenter
        mask: 255.255.252.0
        gw: 192.168.0.1
        nested_cluster: tkgs-cluster # the nested vcenter cluster, which is defined in the clusters section.
        
distributed_switches: # To not create any distributed switches, comment this section.
    -   vds_name: tkgs-vds
        mtu: 1500
        vds_version: 7.0.0 # Should be 7.0.0, 6.7.0
        clusters: # distributed switch will be attached to all hosts in the cluster
            - tkgs-cluster
        uplink_quantity: 1
        vmnics:
            - vmnic1
        distributed_port_groups: # Remove to create an empty VDS
            -   port_group_name: routed-pg
                vlan_id: "0"
            -   port_group_name: private-pg
                vlan_id: "666"

tkgs:
    datastore_tag_category: tkgs-storage-category        
    datastore_tag: tkgs-storage
    datastore_to_tag: datastore-esx1
    load_balancer_ip: "192.168.0.173:5556"
    load_balancer_virtual_servers: 172.31.0.10-172.31.0.50
    management_port_group: routed-pg
    management_subnet: "255.255.252.0"
    management_gateway: "192.168.0.1"
    workload_port_group: private-pg
    workload_subnet: "255.255.255.0"
    workload_gateway: "172.31.0.1"
    workload_ip_range: 172.31.0.51-172.31.0.100

vyos:
    cluster: tkgs-cluster
    datastore: datastore-esx1
    uplink_ip: "192.168.0.170"
    uplink_netmask: "255.255.252.0"
    uplink_network_gateway: "192.168.0.1"
    uplink_port_group: routed-pg
    internal_ip: "172.31.0.0"
    internal_netmask: "255.255.255.0"
    internal_network_gateway: "172.31.0.1"
    internal_port_group: private-pg
    admin_password: "{{master_password}}"

haproxy:
    cluster: "tkgs-cluster"
    datastore: "datastore-esx1"
    root_pwd: "{{ master_password }}"
    nameservers: "{{ dns1 }}, {{ dns2 }}"
    management_ip: "192.168.0.173/22"
    management_port: 5556 # not set
    management_gateway: "192.168.0.1"
    management_port_group: "routed-pg"
    workload_ip: "172.31.0.2"
    workload_gateway: "172.31.0.1/24"
    workload_port_group: "private-pg"
    service_ip_range: "172.31.0.128/25"
    haproxy_user: admin
    haproxy_pwd: "{{ master_password }}"



